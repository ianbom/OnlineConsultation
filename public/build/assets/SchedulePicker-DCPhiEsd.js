import{j as e,r as c,L as _,a as D}from"./app-D6xwxhHg.js";import{A as P,a as A,b as L,P as M,d as I}from"./PageLayout-DBHhHrCo.js";import{C as T,c as B,B as g}from"./card-ConOpLFV.js";import{a as u,C as R,b as W,T as E}from"./CalendarHeader-N2zOT_lv.js";import{s as z,f as j}from"./format-DKbtvHO8.js";import{C as K}from"./chevron-left-CvCy4MV5.js";import"./index-AU5kxg5P.js";import"./clock-CdVmIq_p.js";function O({counselor:s}){const o=s.user.profile_pic?`/storage/${s.user.profile_pic}`:null;return e.jsx(T,{className:"mb-6",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(P,{className:"h-14 w-14 rounded-lg",children:[e.jsx(A,{src:o||void 0,alt:s.user.name}),e.jsx(L,{className:"rounded-lg",children:s.user.name.split(" ").map(m=>m[0]).join("")})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:s.user.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Rp ",s.price_per_session.toLocaleString("id-ID")," per sesi"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pilih 1–2 jam konseling yang berdampingan"})]})]})})})}function V({counselor:s}){const[o,m]=c.useState(z(new Date,{weekStartsOn:1})),[n,S]=c.useState(null),[a,d]=c.useState([]),N=Array.from({length:7},(t,r)=>u(o,r)),f=c.useMemo(()=>{const t={};return s.schedules.forEach(r=>{if(r.is_available===1){const i=r.date;t[i]||(t[i]=[]),t[i].push(r)}}),t},[s.schedules]);console.log("slot",f);const x=t=>{const r=j(t,"yyyy-MM-dd");return(f[r]||[]).map(l=>({id:l.id,time:l.start_time.substring(0,5),startTime:l.start_time,endTime:l.end_time,isBooked:!1})).sort((l,p)=>l.time.localeCompare(p.time))},b=(t,r)=>{const[i]=t.split(":").map(Number),[l]=r.split(":").map(Number);return Math.abs(i-l)===1},h=t=>a.length===0?!0:a.length===1?b(a[0].time,t.time):!1,v=t=>{S(t),d([])},w=t=>{if(a.some(i=>i.id===t.id))d(a.filter(i=>i.id!==t.id));else if(h(t)){const i=[...a,t].sort((l,p)=>l.time.localeCompare(p.time));d(i)}},y=()=>{if(a.length>0){const t=a.map(r=>r.id).join(",");D.visit(route("client.process.payment",{counselorId:s.id,scheduleIds:t}))}},C=n?x(n):[];console.log("ava slots",C),s.user.profile_pic&&`${s.user.profile_pic}`;const k=s.price_per_session*a.length;return e.jsx(M,{children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(g,{variant:"ghost",asChild:!0,className:"mb-4",children:e.jsxs(_,{href:route("client.counselor.show",s.id),children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Kembali ke Profil"]})}),e.jsx(O,{counselor:s}),e.jsx(R,{weekStart:o,onPrevWeek:()=>m(u(o,-7)),onNextWeek:()=>m(u(o,7))}),e.jsx(W,{weekDays:N,selectedDate:n,onSelectDate:v,getAvailableSlots:x}),n&&e.jsx(E,{selectedDate:n,availableSlots:x(n),selectedSlots:a,canSelectSlot:h,onSelectSlot:w}),n&&a.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-card border-t shadow-lg animate-slide-up z-50",children:e.jsxs("div",{className:`
                max-w-3xl mx-auto
                flex flex-col sm:flex-row
                items-start sm:items-center
                gap-3 sm:gap-0
                justify-between
              `,children:[e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Terpilih"}),e.jsxs("p",{className:"font-medium text-foreground",children:[j(n,"d MMM yyyy")," • ",a.map(t=>t.time).join(", ")]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: Rp ",k.toLocaleString("id-ID")," (",a.length," sesi)"]})]}),e.jsxs(g,{size:"lg",onClick:y,className:`
                  w-full sm:w-auto
                  text-center
                  flex items-center justify-center
                `,children:["Lanjutkan Pemesanan",e.jsx(I,{className:"h-4 w-4 ml-1"})]})]})})]})})}export{V as default};
