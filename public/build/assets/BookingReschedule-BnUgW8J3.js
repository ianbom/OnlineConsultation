import{j as e,r as m,L as Z,a as ee}from"./app-CMEvEkaP.js";import{C as se}from"./clock-DLOao912.js";import{c as w,a as te,B as y}from"./button-DFWESZbF.js";import{C as k,P as ae,I as P}from"./PageLayout-CGELvftg.js";import{C as E}from"./circle-alert-CaXdiH1k.js";import{f as W}from"./format-DKbtvHO8.js";import{i as re}from"./id-BLZN8RMz.js";import{a as v,C as le,b as ne,T as ie}from"./TimeSlots-DH-yqc_V.js";import{C as R,a as T,b as B,c as M}from"./card-GVVAMpoF.js";import{g as de}from"./booking-BWQIzxkQ.js";import{C as oe}from"./chevron-left-BErdDeQE.js";import"./index-DW7OYsA0.js";const ce=({duration:r,onChange:a,locked:l})=>{const c=[{hours:1,label:"1 Jam",sublabel:"Sesi standar"},{hours:2,label:"2 Jam",sublabel:"Sesi extended"}];return e.jsx("div",{className:"space-y-2",children:c.map(i=>e.jsx("button",{onClick:()=>a(i.hours),disabled:l,className:`w-full rounded-lg border-2 p-3 text-left transition-colors ${r===i.hours?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${l?"cursor-not-allowed opacity-60":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.sublabel})]}),e.jsx(se,{className:"h-5 w-5 text-muted-foreground"})]})},i.hours))})},me=te("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),g=m.forwardRef(({className:r,variant:a,...l},c)=>e.jsx("div",{ref:c,role:"alert",className:w(me({variant:a}),r),...l}));g.displayName="Alert";const ue=m.forwardRef(({className:r,...a},l)=>e.jsx("h5",{ref:l,className:w("mb-1 font-medium leading-none tracking-tight",r),...a}));ue.displayName="AlertTitle";const j=m.forwardRef(({className:r,...a},l)=>e.jsx("div",{ref:l,className:w("text-sm [&_p]:leading-relaxed",r),...a}));j.displayName="AlertDescription";const xe=({selectedDate:r,selectedSlots:a,durationHours:l,maxSessions:c,onReset:i,onConfirm:p,isProcessing:d})=>a.length===0?null:e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsxs("div",{className:"space-y-2 rounded-lg bg-primary/5 p-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Jadwal Baru:"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"mt-0.5 h-4 w-4 text-primary"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:r&&W(r,"EEEE, dd MMMM yyyy",{locale:re})}),e.jsxs("p",{className:"text-muted-foreground",children:[a[0].time," -"," ",a[a.length-1].endTime.substring(0,5)]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Durasi: ",l," jam"]})]})]}),c===2&&a.length===1&&e.jsxs(g,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(j,{children:"Pilih 1 slot lagi yang berurutan untuk sesi 2 jam."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(y,{variant:"outline",onClick:i,className:"flex-1",children:"Reset"}),e.jsx(y,{onClick:p,disabled:d||a.length!==l,className:"flex-1",children:d?"Memproses...":"Konfirmasi Reschedule"})]})]});function Ce({booking:r,counselor:a,schedulesByDate:l={},originalDurationHours:c}){const[i,p]=m.useState(()=>{const s=new Date,o=s.getDay(),h=o===0?-6:1-o,t=v(s,h);return t.setHours(0,0,0,0),t}),[d,N]=m.useState(null),[n,u]=m.useState([]),[I,S]=m.useState(!1),J=c??r?.duration_hours??1,C=typeof c<"u"||!!(r&&r.duration_hours),[x,K]=m.useState(J),L=Array.from({length:7},(s,o)=>v(i,o)),b=x,H=de(a.user.profile_pic),U=(s,o)=>{const[h,t]=s.split(":").map(Number),[f,Q]=o.split(":").map(Number),X=h*60+t,Y=f*60+Q;return Math.abs(Y-X)===60},D=s=>n.length===0?!0:b===1?!1:n.length===1&&b===2?U(n[0].time,s.time):!1,_=s=>{const o=W(s,"yyyy-MM-dd");return(l[o]||[]).filter(t=>t.is_available).map(t=>({id:t.id,time:t.start_time.substring(0,5),startTime:t.start_time,endTime:t.end_time,isBooked:!t.is_available})).sort((t,f)=>t.time.localeCompare(f.time))},F=()=>{p(v(i,-7)),N(null),u([])},V=()=>{p(v(i,7)),N(null),u([])},$=s=>{N(s),u([])},G=s=>{if(n.some(t=>t.id===s.id)){u(n.filter(t=>t.id!==s.id));return}if(n.length>=b||!D(s))return;const h=[...n,s].sort((t,f)=>t.time.localeCompare(f.time));u(h)},q=s=>{C||(K(s),u([]))},z=()=>{N(null),u([])},O=()=>{if(!d||n.length!==x)return;S(!0);const s={schedule_id:n[0].id,duration_hours:x};n.length===2&&(s.second_schedule_id=n[1].id),ee.post(route("client.reschedule.booking",r.id),s,{onSuccess:()=>{},onFinish:()=>{S(!1)}})},A=d?_(d):[];return e.jsx(ae,{children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4",children:[e.jsx(y,{variant:"ghost",asChild:!0,className:"mb-4",children:e.jsxs(Z,{href:route("client.booking.detail",r.id),children:[e.jsx(oe,{className:"mr-1 h-4 w-4"}),"Kembali ke Detail Booking"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"mb-2 font-display text-2xl font-semibold text-foreground",children:"Reschedule Booking"}),e.jsx("p",{className:"text-muted-foreground",children:"Pilih jadwal baru untuk sesi konseling Anda"})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(R,{className:"sticky top-4",children:[e.jsx(T,{children:e.jsx(B,{className:"text-lg",children:"Info Konselor"})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative h-12 w-12 overflow-hidden rounded-full bg-muted",children:e.jsx("img",{src:H,alt:a.user.name,className:"h-full w-full object-cover",onError:s=>{s.currentTarget.src="/default-avatar.png"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.user.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Konselor"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("p",{className:"mb-3 text-sm font-medium",children:"Pilih Durasi Sesi"}),e.jsx(ce,{duration:x,onChange:q,locked:C})]}),x===2&&e.jsxs(g,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(j,{className:"text-xs",children:"Untuk sesi 2 jam, Anda perlu memilih 2 slot waktu yang berurutan."})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(R,{children:[e.jsx(T,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Pilih Jadwal Baru"]})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs(g,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsxs(j,{children:["Pilih tanggal dan waktu baru untuk sesi konseling Anda.",x===2&&" Pilih 2 slot waktu yang berurutan untuk sesi 2 jam."]})]}),e.jsx(le,{weekStart:i,onPrevWeek:F,onNextWeek:V}),e.jsx(ne,{weekDays:L,selectedDate:d,onSelectDate:$,getAvailableSlots:_}),d&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{selectedDate:d,availableSlots:A,selectedSlots:n,canSelectSlot:D,onSelectSlot:G}),A.length===0&&e.jsxs(g,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(j,{children:"Tidak ada slot waktu tersedia untuk tanggal ini."})]})]}),e.jsx(xe,{selectedDate:d,selectedSlots:n,durationHours:x,maxSessions:b,onReset:z,onConfirm:O,isProcessing:I}),!d&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(k,{className:"mx-auto mb-3 h-12 w-12 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pilih tanggal untuk melihat slot waktu yang tersedia"})]})]})]})})]})]})})}export{Ce as default};
