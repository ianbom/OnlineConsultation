import{r as o,j as e,L as Z,a as ee}from"./app-Cphvz44M.js";import{P as se,I as T,C as y}from"./PageLayout-DDXYa8m8.js";import{C as B,a as M,b as E,c as $}from"./card-DH1y5Idi.js";import{c as w,a as te,B as k}from"./button-LSwK0d_m.js";import{a as b,C as ae,b as re,T as le}from"./CalendarHeader-DagD7Ni_.js";import{C as ie}from"./chevron-left-B8LhDHpc.js";import{C as I}from"./clock-BLq7A0NJ.js";import{C as W}from"./circle-alert-Bx48R3hi.js";import{f as H}from"./format-DKbtvHO8.js";import{i as ne}from"./id-BLZN8RMz.js";import"./index-DS3aEpLL.js";const de=te("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),f=o.forwardRef(({className:r,variant:l,...c},g)=>e.jsx("div",{ref:g,role:"alert",className:w(de({variant:l}),r),...c}));f.displayName="Alert";const oe=o.forwardRef(({className:r,...l},c)=>e.jsx("h5",{ref:c,className:w("mb-1 font-medium leading-none tracking-tight",r),...l}));oe.displayName="AlertTitle";const p=o.forwardRef(({className:r,...l},c)=>e.jsx("div",{ref:c,className:w("text-sm [&_p]:leading-relaxed",r),...l}));p.displayName="AlertDescription";function ke({booking:r,counselor:l,schedulesByDate:c={},originalDurationHours:g,originalSecondScheduleId:ce}){const[j,S]=o.useState(()=>{const s=new Date,d=s.getDay(),u=d===0?-6:1-d,t=b(s,u);return t.setHours(0,0,0,0),t}),[i,N]=o.useState(null),[a,m]=o.useState([]),[C,_]=o.useState(!1),J=g??r?.duration_hours??1,x=typeof g<"u"||!!(r&&r.duration_hours),[n,K]=o.useState(J),L=Array.from({length:7},(s,d)=>b(j,d)),v=n,U=(s,d)=>{const[u,t]=s.split(":").map(Number),[h,Q]=d.split(":").map(Number),X=u*60+t,Y=h*60+Q;return Math.abs(Y-X)===60},D=s=>a.length===0?!0:v===1?!1:a.length===1&&v===2?U(a[0].time,s.time):!1,A=s=>{const d=H(s,"yyyy-MM-dd");return(c[d]||[]).filter(t=>t.is_available).map(t=>({id:t.id,time:t.start_time.substring(0,5),startTime:t.start_time,endTime:t.end_time,isBooked:!t.is_available})).sort((t,h)=>t.time.localeCompare(h.time))},F=()=>{S(b(j,-7)),N(null),m([])},V=()=>{S(b(j,7)),N(null),m([])},G=s=>{N(s),m([])},q=s=>{if(a.some(t=>t.id===s.id)){m(a.filter(t=>t.id!==s.id));return}if(a.length>=v||!D(s))return;const u=[...a,s].sort((t,h)=>t.time.localeCompare(h.time));m(u)},R=s=>{x||(K(s),m([]))},z=()=>{if(!i||a.length!==n)return;_(!0);const s={schedule_id:a[0].id,duration_hours:n};a.length===2&&(s.second_schedule_id=a[1].id),ee.post(route("client.reschedule.booking",r.id),s,{onSuccess:()=>{},onFinish:()=>{_(!1)}})},P=i?A(i):[],O=l.user.profile_pic?`http://127.0.0.1:8000/storage/${l.user.profile_pic}`:"/default-avatar.png";return e.jsx(se,{children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4",children:[e.jsx(k,{variant:"ghost",asChild:!0,className:"mb-4",children:e.jsxs(Z,{href:route("client.booking.history"),children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Kembali ke Riwayat Booking"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"font-display text-2xl font-semibold text-foreground mb-2",children:"Reschedule Booking"}),e.jsx("p",{className:"text-muted-foreground",children:"Pilih jadwal baru untuk sesi konseling Anda"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(B,{className:"sticky top-4",children:[e.jsx(M,{children:e.jsx(E,{className:"text-lg",children:"Info Konselor"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative h-12 w-12 rounded-full overflow-hidden bg-muted",children:e.jsx("img",{src:O,alt:l.user.name,className:"h-full w-full object-cover",onError:s=>{s.currentTarget.src="/default-avatar.png"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.user.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Konselor"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:"Pilih Durasi Sesi"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>R(1),disabled:x,className:`w-full p-3 rounded-lg border-2 transition-colors text-left ${n===1?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${x?"opacity-60 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"1 Jam"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sesi standar"})]}),e.jsx(I,{className:"h-5 w-5 text-muted-foreground"})]})}),e.jsx("button",{onClick:()=>R(2),disabled:x,className:`w-full p-3 rounded-lg border-2 transition-colors text-left ${n===2?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${x?"opacity-60 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"2 Jam"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sesi extended"})]}),e.jsx(I,{className:"h-5 w-5 text-muted-foreground"})]})})]})]}),n===2&&e.jsxs(f,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(p,{className:"text-xs",children:"Untuk sesi 2 jam, Anda perlu memilih 2 slot waktu yang berurutan."})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(B,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Pilih Jadwal Baru"]})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs(f,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs(p,{children:["Pilih tanggal dan waktu baru untuk sesi konseling Anda.",n===2&&" Pilih 2 slot waktu yang berurutan untuk sesi 2 jam."]})]}),e.jsx(ae,{weekStart:j,onPrevWeek:F,onNextWeek:V}),e.jsx(re,{weekDays:L,selectedDate:i,onSelectDate:G,getAvailableSlots:A}),i&&e.jsxs(e.Fragment,{children:[e.jsx(le,{selectedDate:i,availableSlots:P,selectedSlots:a,canSelectSlot:D,onSelectSlot:q}),P.length===0&&e.jsxs(f,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(p,{children:"Tidak ada slot waktu tersedia untuk tanggal ini."})]})]}),a.length>0&&e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg space-y-2",children:[e.jsx("p",{className:"font-medium text-sm",children:"Jadwal Baru:"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(y,{className:"h-4 w-4 mt-0.5 text-primary"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:i&&H(i,"EEEE, dd MMMM yyyy",{locale:ne})}),e.jsxs("p",{className:"text-muted-foreground",children:[a[0].time," - ",a[a.length-1].endTime.substring(0,5)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Durasi: ",n," jam"]})]})]}),v===2&&a.length===1&&e.jsxs(f,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(p,{children:"Pilih 1 slot lagi yang berurutan untuk sesi 2 jam."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"outline",onClick:()=>{N(null),m([])},className:"flex-1",children:"Reset"}),e.jsx(k,{onClick:z,disabled:C||a.length!==n,className:"flex-1",children:C?"Memproses...":"Konfirmasi Reschedule"})]})]}),!i&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pilih tanggal untuk melihat slot waktu yang tersedia"})]})]})]})})]})]})})}export{ke as default};
